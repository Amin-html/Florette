{% extends 'shop/base.html' %}
{% block title %}Панель управления — Florette{% endblock %}

{% block extra_css %}
<style>
.admin-header { display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem; }
.admin-table { width:100%;border-collapse:collapse;background:white;border-radius:16px;overflow:hidden;box-shadow:var(--shadow); }
.admin-table th { background:var(--accent-light);padding:1rem;text-align:left;font-size:0.85rem;text-transform:uppercase;letter-spacing:0.05em;color:#1a1a1a; }
.admin-table td { padding:1rem;border-bottom:1px solid var(--border);vertical-align:middle; }
.admin-table tr:last-child td { border-bottom:none; }
.admin-table tr:hover td { background:var(--accent-light); }
.admin-section { margin-bottom:3rem; }
.stats-row { display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:1rem;margin-bottom:2.5rem; }
.stat-card { background:white;border-radius:16px;padding:1.5rem;text-align:center;box-shadow:var(--shadow); }
.stat-card .num { font-size:2.5rem;font-weight:700;color:#2d2d2d; }
.stat-card .lbl { color:var(--text-muted);font-size:0.85rem;margin-top:0.3rem; }
.thumb { width:48px;height:48px;object-fit:cover;border-radius:8px; }
.thumb-emoji { width:48px;height:48px;background:var(--accent-light);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.5rem; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Панель управления</h1>
    <p>Управляйте товарами и заказами</p>
</div>
<section class="section">
<div class="container">

<div class="stats-row">
    <div class="stat-card"><div class="num">{{ flowers|length }}</div><div class="lbl">Всего цветов</div></div>
    <div class="stat-card"><div class="num">{{ orders|length }}</div><div class="lbl">Заказов</div></div>
</div>

<div class="admin-section">
    <div class="admin-header">
        <h2 style="font-family:'Inter',sans-serif;font-size:1.6rem;color:#1a1a1a;">Цветы</h2>
        <a href="{% url 'flower_add' %}" class="btn btn-primary">+ Добавить цветок</a>
    </div>
    <table class="admin-table">
        <thead>
            <tr>
                <th>Фото</th>
                <th>Название</th>
                <th>Цена</th>
                <th>Категория</th>
                <th>Наличие</th>
                <th>Хит</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% for flower in flowers %}
            <tr>
                <td>
                    {% if flower.image %}
                        <img src="{{ flower.image.url }}" class="thumb">
                    {% else %}
                        <div class="thumb-emoji"></div>
                    {% endif %}
                </td>
                <td><strong>{{ flower.name }}</strong></td>
                <td><span style="color:#2d2d2d;font-weight:700;">{{ flower.price }} ₽</span></td>
                <td>{{ flower.category.name|default:"—" }}</td>
                <td>{% if flower.in_stock %}<span style="color:green;font-weight:700;">✓</span>{% else %}<span style="color:#ccc;">✗</span>{% endif %}</td>
                <td>{% if flower.is_featured %}<span style="color:#2d2d2d;">★</span>{% else %}—{% endif %}</td>
                <td style="display:flex;gap:0.5rem;align-items:center;">
                    <a href="{% url 'flower_edit' flower.pk %}" class="btn btn-outline btn-sm">Изменить</a>
                    <a href="{% url 'flower_delete' flower.pk %}" class="btn btn-danger btn-sm">Удалить</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" style="text-align:center;color:var(--text-muted);padding:2rem;">Цветы ещё не добавлены</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="admin-section">
    <h2 style="font-family:'Inter',sans-serif;font-size:1.6rem;color:#1a1a1a;margin-bottom:1.5rem;">Последние заказы</h2>
    <table class="admin-table">
        <thead>
            <tr><th>#</th><th>Покупатель</th><th>Сумма</th><th>Статус</th><th>Дата</th></tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.user.username }}</td>
                <td style="color:#2d2d2d;font-weight:700;">{{ order.total }} ₽</td>
                <td>{{ order.get_status_display }}</td>
                <td style="color:var(--text-muted);font-size:0.85rem;">{{ order.created_at|date:"d.m.Y H:i" }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="5" style="text-align:center;color:var(--text-muted);padding:2rem;">Заказов пока нет</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

</div>
</section>
{% endblock %}
