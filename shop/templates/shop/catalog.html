{% extends 'shop/base.html' %}
{% block title %}–ö–∞—Ç–∞–ª–æ–≥ ‚Äî Florette{% endblock %}

{% block extra_css %}
<style>
.filters {
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    align-items: flex-end;
}
.filter-group { display: flex; flex-direction: column; gap: 0.4rem; }
.filter-group label { font-size: 0.82rem; font-weight: 700; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
.filter-input {
    padding: 0.6rem 1rem;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: 'Lato', sans-serif;
    font-size: 0.9rem;
    background: white;
    min-width: 160px;
}
.filter-input:focus { outline: none; border-color: #2d2d2d; }
.empty-state { text-align: center; padding: 5rem 2rem; color: var(--text-muted); }
.empty-state span { font-size: 5rem; display: block; margin-bottom: 1rem; }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>–ö–∞—Ç–∞–ª–æ–≥ —Ü–≤–µ—Ç–æ–≤</h1>
    <p>{{ flowers|length }} –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã—Ö –±—É–∫–µ—Ç–æ–≤ –∂–¥—É—Ç –≤–∞—Å</p>
</div>

<section class="section">
<div class="container">

<form method="GET" class="filters">
    <div class="filter-group">
        <label>–ü–æ–∏—Å–∫</label>
        <input type="text" name="q" value="{{ search }}" class="filter-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ...">
    </div>
    <div class="filter-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
        <select name="category" class="filter-input">
            <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
            {% for cat in categories %}
            <option value="{{ cat.slug }}" {% if current_category == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="filter-group">
        <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</label>
        <select name="sort" class="filter-input">
            <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üë</option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>–¶–µ–Ω–∞ ‚Üì</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">–ù–∞–π—Ç–∏</button>
    <a href="{% url 'catalog' %}" class="btn btn-outline">–°–±—Ä–æ—Å–∏—Ç—å</a>
</form>

{% if flowers %}
<div class="grid-4">
    {% for flower in flowers %}
    <div class="flower-card">
        {% if flower.is_featured %}<span class="badge-featured">–•–∏—Ç</span>{% endif %}
        <a href="{% url 'flower_detail' flower.pk %}">
            {% if flower.image %}
                <img src="{{ flower.image.url }}" alt="{{ flower.name }}">
            {% else %}
                <div class="flower-card-placeholder"></div>
            {% endif %}
        </a>
        <div class="flower-card-body">
            <div class="stars">
                {% for i in "12345" %}{% if forloop.counter <= flower.avg_rating %}‚òÖ{% else %}‚òÜ{% endif %}{% endfor %}
                <span style="color:var(--text-muted);font-size:0.82rem;">({{ flower.reviews.count }} –æ—Ç–∑—ã–≤–æ–≤)</span>
            </div>
            <h3 class="flower-card-title">
                <a href="{% url 'flower_detail' flower.pk %}" style="text-decoration:none;color:inherit;">{{ flower.name }}</a>
            </h3>
            {% if flower.category %}<div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:0.5rem;">{{ flower.category.name }}</div>{% endif %}
            <div class="flower-card-price">{{ flower.price }} ‚ÇΩ</div>
            <button onclick="addToCart({{ flower.pk }})" class="btn btn-primary" style="width:100%;justify-content:center;">
                üõí –í –∫–æ—Ä–∑–∏–Ω—É
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <span>üåø</span>
    <h2>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h2>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Å–±—Ä–æ—Å—å—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã</p>
    <a href="{% url 'catalog' %}" class="btn btn-primary" style="margin-top:1rem;">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</a>
</div>
{% endif %}

</div>
</section>
{% endblock %}
